<aside
  [ngClass]="{ 'w-64': isOpen, 'w-20': !isOpen }"
  class="fixed top-0 left-0 z-30 h-screen transition-all duration-300 ease-in-out
         bg-gradient-to-b from-white/90 to-white/70 dark:from-gray-900 dark:to-gray-800/80
         text-gray-900 dark:text-white
         backdrop-blur-md shadow-md dark:shadow-lg
         border-r border-gray-200/60 dark:border-gray-700/40
         rounded-tr-3xl overflow-hidden"
>

  <!-- üîò Bot√≥n de colapsar flotante separado del branding -->
  <div class="absolute top-3 right-2 z-50">
    <button (click)="toggleSidebar()"
      class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition"
      aria-label="Toggle sidebar">
      <span class="material-icons text-gray-600 dark:text-gray-300 text-xl">
        {{ isOpen ? 'chevron_left' : 'chevron_right' }}
      </span>
    </button>
  </div>

  <!-- üîù Branding con animaci√≥n -->
  <div class="mb-6 flex items-center justify-center h-16 relative">
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-100/60 to-pink-100/40 dark:from-indigo-800/30 dark:to-pink-800/10 blur-sm rounded-xl -z-0"></div>

    <ng-container *ngIf="isOpen; else shortBrand">
      <h1 class="relative z-10 text-4xl font-black tracking-wider text-indigo-600 dark:text-indigo-400 transition-all duration-500 ease-in-out">
        <span class="inline-block animate-fade-in-down">T</span>
        <span class="inline-block animate-fade-in-left delay-100">a</span>
        <span class="inline-block animate-fade-in-left delay-200">s</span>
        <span class="inline-block animate-fade-in-left delay-300">k</span>
        <span class="inline-block animate-fade-in-left delay-400">l</span>
        <span class="inline-block animate-fade-in-left delay-500">y</span>
      </h1>
    </ng-container>
    <ng-template #shortBrand>
      <span class="relative z-10 text-3xl font-black text-indigo-600 dark:text-indigo-400">T</span>
    </ng-template>
  </div>
  
  <div class="relative z-10 h-full flex flex-col justify-between overflow-y-auto px-3 py-4 font-sans">
    <!-- üß≠ Men√∫ Principal -->
    <div class="flex items-center gap-2 px-2 mb-3">
      <span class="w-1.5 h-1.5 rounded-full bg-indigo-500/70"></span>
      <h2 *ngIf="isOpen" class="text-xs font-medium tracking-wider text-gray-500 dark:text-gray-400 uppercase">Men√∫ principal</h2>
      <div class="flex-1 h-px bg-gradient-to-r from-gray-300/40 to-transparent dark:from-gray-600/20"></div>
    </div>

    <ul class="space-y-1 text-sm font-medium text-gray-700 dark:text-gray-200">
      <ng-container *ngFor="let group of visibleMenuGroups.slice(0, 7)">
        <li>
          <button (click)="toggleGroup(group.section)"
            class="w-full flex items-center gap-3 rounded-xl px-3 py-2 group relative
                   transition-all duration-200 ease-in-out
                   text-gray-600 dark:text-gray-300
                   hover:bg-white dark:hover:bg-gray-800
                   hover:shadow-sm hover:ring-1 hover:ring-indigo-400/30">
            <span class="material-icons text-[20px] p-1 rounded-md bg-indigo-50 dark:bg-indigo-900/30 group-hover:text-indigo-600 dark:group-hover:text-white">
              {{ getGroupIcon(group) }}
            </span>
            <span *ngIf="isOpen" class="flex-1 font-semibold text-left">{{ group.section }}</span>
            <span *ngIf="isOpen" class="material-icons text-sm text-gray-400 transition-transform duration-300"
                  [ngClass]="{ 'rotate-180': isGroupOpen(group.section) }">expand_more</span>
          </button>

          <ul *ngIf="isGroupOpen(group.section)" [ngClass]="{ 'pl-8': isOpen, 'pl-1': !isOpen }" class="space-y-0.5">
            <li *ngFor="let item of group.items">
              <a [routerLink]="item.link" routerLinkActive="active-link"
                 class="relative group flex items-center gap-3 px-3 py-2 rounded-lg text-sm
                        text-gray-700 dark:text-gray-200
                        transition duration-200 ease-in-out
                        hover:translate-x-1 hover:bg-indigo-100 hover:text-indigo-700
                        dark:hover:bg-indigo-800 dark:hover:text-white">
                <span class="material-icons text-base">{{ item.icon }}</span>
                <span *ngIf="isOpen">{{ item.label }}</span>
                <span *ngIf="!isOpen"
                      class="absolute left-full top-1/2 -translate-y-1/2 ml-3 whitespace-nowrap px-2 py-1
                             rounded bg-gray-800 text-white text-xs shadow-lg z-50
                             opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-300">
                  {{ item.label }}
                </span>
              </a>
            </li>
          </ul>
        </li>
      </ng-container>
    </ul>

    <!-- üóÇÔ∏è Secci√≥n: Otros -->
    <div class="flex items-center gap-2 px-2 mt-6 mb-2">
      <span class="w-1.5 h-1.5 rounded-full bg-indigo-500/70"></span>
      <h2 *ngIf="isOpen" class="text-xs font-medium tracking-wider text-gray-500 dark:text-gray-400 uppercase">Otros</h2>
      <div class="flex-1 h-px bg-gradient-to-r from-gray-300/40 to-transparent dark:from-gray-600/20"></div>
    </div>

    <ul class="space-y-1 text-sm font-medium text-gray-700 dark:text-gray-200">
      <ng-container *ngFor="let group of visibleMenuGroups.slice(7)">
        <li>
          <button (click)="toggleGroup(group.section)"
            class="w-full flex items-center gap-3 rounded-xl px-3 py-2 group relative
                   transition-all duration-200 ease-in-out
                   text-gray-600 dark:text-gray-300
                   hover:bg-white dark:hover:bg-gray-800
                   hover:shadow-sm hover:ring-1 hover:ring-indigo-400/30">
            <span class="material-icons text-[20px] p-1 rounded-md bg-indigo-50 dark:bg-indigo-900/30 group-hover:text-indigo-600 dark:group-hover:text-white">
              {{ getGroupIcon(group) }}
            </span>
            <span *ngIf="isOpen" class="flex-1 font-semibold text-left">{{ group.section }}</span>
            <span *ngIf="isOpen" class="material-icons text-sm text-gray-400 transition-transform duration-300"
                  [ngClass]="{ 'rotate-180': isGroupOpen(group.section) }">expand_more</span>
          </button>

          <ul *ngIf="isGroupOpen(group.section)" [ngClass]="{ 'pl-8': isOpen, 'pl-1': !isOpen }" class="space-y-0.5">
            <li *ngFor="let item of group.items">
              <a [routerLink]="item.link" routerLinkActive="active-link"
                 class="relative group flex items-center gap-3 px-3 py-2 rounded-lg text-sm
                        text-gray-700 dark:text-gray-200
                        transition duration-200 ease-in-out
                        hover:translate-x-1 hover:bg-indigo-100 hover:text-indigo-700
                        dark:hover:bg-indigo-800 dark:hover:text-white">
                <span class="material-icons text-base">{{ item.icon }}</span>
                <span *ngIf="isOpen">{{ item.label }}</span>
                <span *ngIf="!isOpen"
                      class="absolute left-full top-1/2 -translate-y-1/2 ml-3 whitespace-nowrap px-2 py-1
                             rounded bg-gray-800 text-white text-xs shadow-lg z-50
                             opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-300">
                  {{ item.label }}
                </span>
              </a>
            </li>
          </ul>
        </li>
      </ng-container>
    </ul>

    <!-- üîö Logout -->
    <div class="my-4">
      <button (click)="showLogoutModal = true"
        class="flex items-center gap-3 w-full px-3 py-2
               text-red-500 dark:text-red-400 rounded-lg
               hover:bg-red-50 dark:hover:bg-red-900/30 hover:ring-1 hover:ring-red-400/30 transition duration-200">
        <span class="material-icons text-xl">logout</span>
        <span *ngIf="isOpen">Cerrar sesi√≥n</span>
      </button>
    </div>

    <!-- üîΩ Colapsar -->
    <div class="mb-2">
      <button (click)="toggleSidebar()"
        class="flex items-center gap-3 w-full px-3 py-2
               text-gray-600 dark:text-gray-300 rounded-lg
               hover:bg-gray-100 dark:hover:bg-gray-800 hover:scale-105 active:scale-95 transition duration-200
               hover:ring hover:ring-gray-400/20">
        <span class="material-icons text-xl">{{ isOpen ? 'chevron_left' : 'chevron_right' }}</span>
        <span *ngIf="isOpen">Colapsar men√∫</span>
      </button>
    </div>
  </div>
</aside>

<!-- üîê Modal logout -->
<div *ngIf="showLogoutModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md animate-fade-in-down">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">¬øCerrar sesi√≥n?</h3>
    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">Est√°s seguro de que deseas cerrar sesi√≥n?</p>
    <div class="flex justify-end gap-3">
      <button (click)="cancelarLogout()"
              class="px-4 py-2 text-sm rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">
        Cancelar
      </button>
      <button (click)="confirmarLogout()"
              class="px-4 py-2 text-sm rounded bg-red-600 text-white hover:bg-red-700 shadow">
        Cerrar sesi√≥n
      </button>
    </div>
  </div>
</div>